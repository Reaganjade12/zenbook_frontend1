<?php
$title = 'Admin Dashboard - ZenBook';
ob_start();
?>
<!-- Statistics Cards -->
<div class="stats-grid">
    <div class="stat-card" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border: none;">
        <div class="stat-value" style="color: white;"><?php echo $stats['total_bookings']; ?></div>
        <div class="stat-label" style="color: rgba(255,255,255,0.9);">New Booking</div>
    </div>

    <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none;">
        <div class="stat-value" style="color: white;"><?php echo isset($stats['total_therapists']) ? $stats['total_therapists'] : $stats['total_cleaners']; ?></div>
        <div class="stat-label" style="color: rgba(255,255,255,0.9);">Schedule Room</div>
    </div>

    <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border: none;">
        <div class="stat-value" style="color: white;"><?php echo $stats['approved_bookings']; ?></div>
        <div class="stat-label" style="color: rgba(255,255,255,0.9);">Check In</div>
    </div>

    <div class="stat-card" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border: none;">
        <div class="stat-value" style="color: white;"><?php echo $stats['pending_bookings']; ?></div>
        <div class="stat-label" style="color: rgba(255,255,255,0.9);">Check Out</div>
    </div>
</div>

<!-- Bookings Section -->
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
        <div>
            <h2 style="margin: 0; font-family: 'Space Grotesk', sans-serif; font-weight: 700; font-size: 24px; color: white;">
                All Bookings
            </h2>
            <p style="color: var(--dark-text-muted); margin-top: 8px; font-size: 14px;">Manage and monitor all booking requests</p>
        </div>
    </div>
    
    <div class="filter-buttons">
        <a href="<?php echo route('staff.dashboard'); ?>" class="filter-btn <?php echo !request('status') ? 'active' : ''; ?>">
            All
        </a>
        <a href="<?php echo route('staff.dashboard', ['status' => 'pending']); ?>" class="filter-btn <?php echo request('status') == 'pending' ? 'active' : ''; ?>">
            Pending
        </a>
        <a href="<?php echo route('staff.dashboard', ['status' => 'approved']); ?>" class="filter-btn <?php echo request('status') == 'approved' ? 'active' : ''; ?>">
            Approved
        </a>
        <a href="<?php echo route('staff.dashboard', ['status' => 'declined']); ?>" class="filter-btn <?php echo request('status') == 'declined' ? 'active' : ''; ?>">
            Declined
        </a>
        <a href="<?php echo route('staff.dashboard', ['status' => 'in_progress']); ?>" class="filter-btn <?php echo request('status') == 'in_progress' ? 'active' : ''; ?>">
            In Progress
        </a>
        <a href="<?php echo route('staff.dashboard', ['status' => 'completed']); ?>" class="filter-btn <?php echo request('status') == 'completed' ? 'active' : ''; ?>">
            Completed
        </a>
    </div>

    <?php if ($bookings->count() > 0): ?>
        <div style="overflow-x: auto; border-radius: 12px;">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Customer</th>
                        <th>Therapist</th>
                        <th>Massage Type</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach($bookings as $booking): ?>
                    <tr>
                        <td data-label="ID" style="color: var(--dark-text-muted); font-weight: 600;">#<?php echo $booking->id; ?></td>
                        <td data-label="Date" style="font-weight: 600; color: var(--dark-text);"><?php echo $booking->booking_date->format('M d, Y'); ?></td>
                        <td data-label="Time" style="color: var(--dark-text);"><?php echo date('h:i A', strtotime($booking->booking_time)); ?></td>
                        <td data-label="Customer" style="font-weight: 600; color: var(--dark-text);">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="width: 32px; height: 32px; background: rgba(59, 130, 246, 0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; font-weight: 600;"><?php echo strtoupper(substr($booking->customer->name, 0, 1)); ?></span>
                                <?php echo htmlspecialchars($booking->customer->name); ?>
                            </div>
                        </td>
                        <td data-label="Therapist">
                            <?php if ($booking->therapist): ?>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 32px; height: 32px; background: rgba(59, 130, 246, 0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; font-weight: 600;"><?php echo strtoupper(substr($booking->therapist->name, 0, 1)); ?></span>
                                    <?php echo htmlspecialchars($booking->therapist->name); ?>
                                </div>
                            <?php else: ?>
                                <span style="color: var(--dark-text-muted); font-style: italic;">Not assigned</span>
                            <?php endif; ?>
                        </td>
                        <td data-label="Massage Type" style="color: var(--dark-text);">
                            <span style="padding: 6px 12px; background: rgba(255,255,255,0.05); border-radius: 8px; font-size: 13px; font-weight: 500;"><?php echo htmlspecialchars($booking->service_type); ?></span>
                        </td>
                        <td data-label="Status">
                            <span class="badge badge-<?php echo str_replace('_', '-', $booking->status); ?>">
                                <?php echo ucfirst(str_replace('_', ' ', $booking->status)); ?>
                            </span>
                        </td>
                        <td data-label="Actions">
                            <form action="<?php echo route('staff.booking.delete', $booking->id); ?>" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this booking?');">
                                <input type="hidden" name="_token" value="<?php echo csrf_token(); ?>">
                                <input type="hidden" name="_method" value="DELETE">
                                <button type="submit" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px; border-radius: 6px;">
                                    Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    <?php else: ?>
        <div style="text-align: center; padding: 60px 20px; background: rgba(255,255,255,0.02); border-radius: 16px;">
            <div style="font-size: 64px; margin-bottom: 20px; color: var(--dark-text-muted);">□</div>
            <h3 style="color: var(--dark-text); margin-bottom: 10px; font-family: 'Space Grotesk', sans-serif; font-weight: 600;">No bookings found</h3>
            <p style="color: var(--dark-text-muted);">No bookings match your current filter criteria.</p>
        </div>
    <?php endif; ?>
</div>

<!-- Users Section -->
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
        <div>
            <h2 style="margin: 0; font-family: 'Space Grotesk', sans-serif; font-weight: 700; font-size: 24px; color: white;">
                All Customers
            </h2>
            <p style="color: var(--dark-text-muted); margin-top: 8px; font-size: 14px;">View and manage all customer accounts</p>
        </div>
    </div>
    
    <?php if ($users->count() > 0): ?>
        <div style="overflow-x: auto; border-radius: 12px;">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Registered</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach($users as $user): ?>
                    <tr>
                        <td style="color: var(--dark-text-muted); font-weight: 600;">#<?php echo $user->id; ?></td>
                        <td style="font-weight: 600; color: var(--dark-text);">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="width: 40px; height: 40px; background: rgba(59, 130, 246, 0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; font-weight: 600;"><?php echo strtoupper(substr($user->name, 0, 1)); ?></span>
                                <?php echo htmlspecialchars($user->name); ?>
                            </div>
                        </td>
                        <td style="color: var(--dark-text);"><?php echo htmlspecialchars($user->email); ?></td>
                        <td style="color: var(--dark-text-muted); font-size: 13px;"><?php echo $user->created_at->format('M d, Y'); ?></td>
                        <td>
                            <form action="<?php echo route('staff.user.delete', $user->id); ?>" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this user?');">
                                <input type="hidden" name="_token" value="<?php echo csrf_token(); ?>">
                                <input type="hidden" name="_method" value="DELETE">
                                <button type="submit" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px; border-radius: 6px;">
                                    Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    <?php else: ?>
        <div style="text-align: center; padding: 60px 20px; background: rgba(255,255,255,0.02); border-radius: 16px;">
            <div style="font-size: 64px; margin-bottom: 20px; color: var(--dark-text-muted);">○</div>
            <h3 style="color: var(--dark-text); margin-bottom: 10px; font-family: 'Space Grotesk', sans-serif; font-weight: 600;">No customers found</h3>
            <p style="color: var(--dark-text-muted);">No customers have registered yet.</p>
        </div>
    <?php endif; ?>
</div>

<!-- Therapists Section -->
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
        <div>
            <h2 style="margin: 0; font-family: 'Space Grotesk', sans-serif; font-weight: 700; font-size: 24px; color: white;">
                All Massage Therapists
            </h2>
            <p style="color: var(--dark-text-muted); margin-top: 8px; font-size: 14px;">View and manage all therapist accounts</p>
        </div>
        <a href="<?php echo route('staff.therapists.index'); ?>" class="btn btn-primary" style="text-decoration: none;">
            Manage Therapists
        </a>
    </div>
    
    <?php if (isset($therapists) && $therapists->count() > 0): ?>
        <?php $cleaners = $therapists; ?>
    <?php endif; ?>
    <?php if ($cleaners->count() > 0): ?>
        <div style="overflow-x: auto; border-radius: 12px;">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Registered</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach($cleaners as $cleaner): ?>
                    <tr>
                        <td style="color: var(--dark-text-muted); font-weight: 600;">#<?php echo $cleaner->id; ?></td>
                        <td style="font-weight: 600; color: var(--dark-text);">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="width: 40px; height: 40px; background: rgba(59, 130, 246, 0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; font-weight: 600;"><?php echo strtoupper(substr($cleaner->name, 0, 1)); ?></span>
                                <?php echo htmlspecialchars($cleaner->name); ?>
                            </div>
                        </td>
                        <td style="color: var(--dark-text);"><?php echo htmlspecialchars($cleaner->email); ?></td>
                        <td style="color: var(--dark-text-muted); font-size: 13px;"><?php echo $cleaner->created_at->format('M d, Y'); ?></td>
                        <td>
                            <div style="display: flex; gap: 8px;">
                                <a href="<?php echo route('staff.therapists.edit', $cleaner->id); ?>" class="btn btn-warning" style="padding: 6px 12px; font-size: 12px; border-radius: 6px; text-decoration: none;">
                                    Edit
                                </a>
                                <form action="<?php echo route('staff.cleaner.delete', $cleaner->id); ?>" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this massage therapist?');">
                                    <input type="hidden" name="_token" value="<?php echo csrf_token(); ?>">
                                    <input type="hidden" name="_method" value="DELETE">
                                    <button type="submit" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px; border-radius: 6px;">
                                        Delete
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    <?php else: ?>
        <div style="text-align: center; padding: 60px 20px; background: rgba(255,255,255,0.02); border-radius: 16px;">
            <div style="font-size: 64px; margin-bottom: 20px; color: var(--dark-text-muted);">▲</div>
            <h3 style="color: var(--dark-text); margin-bottom: 10px; font-family: 'Space Grotesk', sans-serif; font-weight: 600;">No massage therapists found</h3>
            <p style="color: var(--dark-text-muted); margin-bottom: 25px;">Get started by adding your first therapist</p>
            <a href="<?php echo route('staff.therapists.create'); ?>" class="btn btn-primary" style="text-decoration: none;">
                + Add New Therapist
            </a>
        </div>
    <?php endif; ?>
</div>
<?php
$content = ob_get_clean();
include resource_path('views/layouts/admin.html');
?>
