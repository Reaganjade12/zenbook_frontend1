<?php
$title = 'Book Massage Session - ZenBook';
ob_start();
?>
<div class="card" style="max-width: 700px; margin: 0 auto;">
    <div style="text-align: center; margin-bottom: 30px;">
        <div style="font-size: 48px; margin-bottom: 10px;">âœ¨</div>
        <h1 style="margin: 0;">Book Your Massage Session</h1>
        <p style="color: var(--text-light); margin-top: 8px; font-size: 14px;">Fill in the details to schedule your appointment</p>
    </div>
    
    <form method="POST" action="<?php echo route('customer.booking.store'); ?>">
        <input type="hidden" name="_token" value="<?php echo csrf_token(); ?>">
        
        <div class="form-group">
            <label for="booking_date">ğŸ“… Appointment Date</label>
            <input type="date" id="booking_date" name="booking_date" value="<?php echo htmlspecialchars(old('booking_date', '')); ?>" required min="<?php echo date('Y-m-d'); ?>">
            <small style="color: var(--text-light); font-size: 12px; display: block; margin-top: 5px;">âš ï¸ Past dates (yesterday and earlier) are not available. Please select today or a future date.</small>
        </div>

        <div class="form-group">
            <label for="therapist_id">ğŸ‘¨â€âš•ï¸ Select Massage Therapist</label>
            <select id="therapist_id" name="therapist_id" required style="cursor: pointer;">
                <option value="">Choose an available therapist...</option>
                <?php if (isset($availableTherapists) && $availableTherapists->count() > 0): ?>
                    <?php foreach($availableTherapists as $therapist): ?>
                        <option value="<?php echo $therapist['id']; ?>" <?php echo old('therapist_id') == $therapist['id'] ? 'selected' : ''; ?>>
                            <?php echo htmlspecialchars($therapist['name']); ?>
                            <?php if (!empty($therapist['bio'])): ?>
                                - <?php echo htmlspecialchars(substr($therapist['bio'], 0, 50)); ?>...
                            <?php endif; ?>
                        </option>
                    <?php endforeach; ?>
                <?php else: ?>
                    <option value="" disabled>No therapists available at the moment</option>
                <?php endif; ?>
            </select>
            <?php if (!isset($availableTherapists) || $availableTherapists->count() == 0): ?>
                <small style="color: #ef4444; font-size: 12px; display: block; margin-top: 5px;">âš ï¸ No therapists are currently available. Please check back later.</small>
            <?php else: ?>
                <small style="color: var(--text-light); font-size: 12px; display: block; margin-top: 5px;">Only available therapists are shown</small>
            <?php endif; ?>
        </div>

        <div class="form-group">
            <label for="booking_time">ğŸ• Appointment Time</label>
            <input type="time" id="booking_time" name="booking_time" value="<?php echo htmlspecialchars(old('booking_time', '')); ?>" required>
        </div>

        <div class="form-group">
            <label for="address">ğŸ“ Service Location</label>
            <textarea id="address" name="address" rows="3" required placeholder="Enter the address where you'd like the massage service"><?php echo htmlspecialchars(old('address', '')); ?></textarea>
        </div>

        <div class="form-group">
            <label for="service_type">ğŸ’† Massage Type</label>
            <select id="service_type" name="service_type" required style="cursor: pointer;">
                <option value="">Select massage type</option>
                <option value="Swedish Massage" <?php echo old('service_type') == 'Swedish Massage' ? 'selected' : ''; ?>>Swedish Massage - Gentle & Relaxing</option>
                <option value="Deep Tissue Massage" <?php echo old('service_type') == 'Deep Tissue Massage' ? 'selected' : ''; ?>>Deep Tissue Massage - Intense Relief</option>
                <option value="Aromatherapy Massage" <?php echo old('service_type') == 'Aromatherapy Massage' ? 'selected' : ''; ?>>Aromatherapy Massage - Essential Oils</option>
                <option value="Hot Stone Massage" <?php echo old('service_type') == 'Hot Stone Massage' ? 'selected' : ''; ?>>Hot Stone Massage - Warm Therapy</option>
                <option value="Prenatal Massage" <?php echo old('service_type') == 'Prenatal Massage' ? 'selected' : ''; ?>>Prenatal Massage - For Expecting Mothers</option>
                <option value="Sports Massage" <?php echo old('service_type') == 'Sports Massage' ? 'selected' : ''; ?>>Sports Massage - Athletic Recovery</option>
                <option value="Thai Massage" <?php echo old('service_type') == 'Thai Massage' ? 'selected' : ''; ?>>Thai Massage - Stretching & Energy</option>
            </select>
        </div>

        <div class="form-group">
            <label for="notes">ğŸ“ Special Requests or Notes (Optional)</label>
            <textarea id="notes" name="notes" rows="4" placeholder="Any specific areas to focus on, allergies, or preferences..."><?php echo htmlspecialchars(old('notes', '')); ?></textarea>
        </div>

        <div style="display: flex; gap: 12px; margin-top: 30px;">
            <button type="submit" class="btn btn-primary" style="flex: 1;">Book Session</button>
            <a href="<?php echo route('customer.dashboard'); ?>" class="btn" style="background: white; color: var(--text-dark); border: 2px solid var(--border); flex: 1; text-align: center;">Cancel</a>
        </div>
    </form>
</div>

<script>
// Prevent past dates (yesterday and earlier) from being selected
document.addEventListener('DOMContentLoaded', function() {
    const bookingDateInput = document.getElementById('booking_date');
    const today = new Date();
    const minDate = today.toISOString().split('T')[0]; // Today's date
    
    // Set minimum date attribute to today
    bookingDateInput.setAttribute('min', minDate);
    
    // Add validation on change
    bookingDateInput.addEventListener('change', function() {
        const selectedDate = new Date(this.value);
        const todayDate = new Date();
        todayDate.setHours(0, 0, 0, 0);
        selectedDate.setHours(0, 0, 0, 0);
        
        // Check if selected date is before today (yesterday or earlier)
        if (selectedDate < todayDate) {
            alert('âš ï¸ Past dates (yesterday and earlier) are not available. Please select today or a future date.');
            this.value = '';
            this.focus();
        }
    });
    
    // Prevent form submission if past date is somehow selected
    const form = bookingDateInput.closest('form');
    form.addEventListener('submit', function(e) {
        const selectedDate = new Date(bookingDateInput.value);
        const todayDate = new Date();
        todayDate.setHours(0, 0, 0, 0);
        selectedDate.setHours(0, 0, 0, 0);
        
        // Check if selected date is before today (yesterday or earlier)
        if (selectedDate < todayDate) {
            e.preventDefault();
            alert('âš ï¸ Past dates (yesterday and earlier) are not available. Please select today or a future date.');
            bookingDateInput.focus();
            return false;
        }
    });
});
</script>
<?php
$content = ob_get_clean();
include resource_path('views/layouts/app.html');
?>
